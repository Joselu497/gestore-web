<div class="max-w-5xl mx-auto">
  <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-lg">
    <div
      class="flex justify-between items-center px-6 py-4 border-b border-gray-200"
    >
      <h2 class="text-lg font-semibold text-gray-900">Ventas</h2>
      <a
        routerLink="./save"
        class="inline-flex items-center gap-x-1.5 rounded-md bg-indigo-600 transition-colors px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
      >
        <ng-icon name="heroPlus"></ng-icon>
        Agregar Venta
      </a>
    </div>

    <div class="overflow-hidden p-6">
      <div class="pb-4">
        <div class="pb-4">
          <app-transaction-filter
            (resetList)="onPageChange(1)"
            (filter)="loadData($event)"
          ></app-transaction-filter>
        </div>
      </div>
      <h5 class="text-md font-semibold text-gray-900">
        Importe total: {{ totalData.totalAmount | currency }}
      </h5>
      <h5 class="text-md font-semibold text-gray-900">
        Ganancia total: {{ totalData.totalGains | currency }}
      </h5>
      <h5 class="text-md font-semibold text-gray-900">
        Recuperado: {{ totalData.totalIncome | currency }}
      </h5>
      <div class="overflow-x-auto overflow-y-hidden relative">
        <table class="min-w-full divide-y-2 divide-gray-200 mt-3">
          <thead class="ltr:text-left rtl:text-right">
            <tr class="*:font-medium *:text-gray-900 *:px-3 *:py-3">
              <th class="whitespace-nowrap">Fecha</th>
              <th class="whitespace-nowrap">Producto</th>
              <th class="whitespace-nowrap text-center">Cantidad</th>
              <th class="whitespace-nowrap text-end">Importe</th>
              <th class="whitespace-nowrap text-end">Ganancia</th>
              <th class="whitespace-nowrap"></th>
            </tr>
          </thead>

          <tbody class="divide-y divide-gray-200 bg-white">
            <ng-container *ngIf="!isLoadingResults(); else loadingTemplate">
              @for (sale of transactions; track sale.id) {
              <tr class="*:text-gray-900 *:first:font-medium *:px-2 *:py-1">
                <td class="whitespace-nowrap">{{ sale.date | date }}</td>
                <td class="whitespace-nowrap">{{ sale.product.name }}</td>
                <td class="whitespace-nowrap text-center">{{ sale.amount }}</td>
                <td class="whitespace-nowrap text-end">
                  {{ sale.price.amount * sale.amount | currency }}
                </td>
                <td class="whitespace-nowrap text-end">
                  {{
                    (sale.price.amount - sale.product.purchasePrice) *
                      sale.amount | currency
                  }}
                </td>
                <td class="whitespace-nowrap text-center flex gap-2">
                  <a
                    [routerLink]="['./save', sale.id]"
                    class="bg-blue-50 hover:bg-blue-200 p-1.5 text-blue-700 transition-colors grid size-8 place-content-center rounded"
                  >
                    <ng-icon name="heroPencil" class=""></ng-icon>
                  </a>
                  <button
                    (click)="onDelete(sale.id)"
                    class="bg-red-50 hover:bg-red-200 p-1.5 text-red-700 transition-colors grid size-8 place-content-center rounded"
                  >
                    <ng-icon name="heroTrash"></ng-icon>
                  </button>
                </td>
              </tr>
              }
            </ng-container>
            <ng-template #loadingTemplate>
              <tr>
                <td colspan="100%" class="px-3 py-8 text-center">
                  <div class="flex justify-center items-center">
                    <div
                      class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"
                    ></div>
                  </div>
                </td>
              </tr>
            </ng-template>

            <tr *ngIf="transactions.length === 0 && !isLoadingResults()">
              <td colspan="5" class="px-3 py-8 text-center text-gray-500">
                No se encontraron ventas
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="mt-4">
        <app-paginator
          [config]="paginationConfig"
          (pageChange)="onPageChange($event)"
        >
        </app-paginator>
      </div>
    </div>
  </div>
</div>
